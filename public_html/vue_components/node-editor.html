<template id='node-editor-template'>
<div class="card" style="margin-bottom:1rem;">
	<div class="card-body" :key="'node_'+node_id">
		<h5 class="card-title">Node #{{node_id+1}}: {{n.kind}}</h5>
		<div class="card-text">
			<div v-if="n.kind=='Quarry'">
				<div>
					<label><span tt="quarry_id"></span> <input type="text" v-model="n.parameters.query_id"/></label>, <i tt="or"></i>
					<label><span tt="run_id"></span> <input type="text" v-model="n.parameters.run_id"/></label>
				</div>
			</div>

			<div v-else-if="n.kind=='Sparql'">
				<textarea v-model="n.parameters.sparql" style="width: 100%;"></textarea>
			</div>

			<div v-else-if="n.kind=='Join'">
				<div v-if="n.parameters.mode=='inner_join_on_key'">
					<label><span tt='join_key'></span> <input type="text" v-model="n.parameters.join_key" /></label>
				</div>
				<div v-else>
					UNKNOWN JOIN MODE {{n.parameters.mode}}
				</div>
			</div>

			<div v-else>
				<div>UNKNOWN TYPE {{n.kind}}</div>
				{{n}}
			</div>

			<header-mapping :header_mapping="n.header_mapping"></header-mapping>

			<div v-if="inputs.length>0">
				<hr/>
				<b>Inputs</b>
				<div v-for="input_node_id,slot in inputs">
					Slot {{slot+1}}: node {{input_node_id+1}} [{{json.nodes[input_node_id].kind}}]
				</div>
			</div>

		</div>
	</div>
</div>
</template>

<script>
'use strict';

Vue.component ( 'node-editor' , {
	template : '#node-editor-template' ,
	props : [ 'json','node_id' ] ,
	data : function () { return { n:{} , inputs:[] } } ,
	created : function () {
		this.n = this.clone_node(this.node_id);
		this.calculate_inputs();
	} ,
	updated : function () {
		this.n = this.clone_node(this.node_id);
		this.calculate_inputs();
	} ,
	methods : {
		clone_node(node_id) {
			return JSON.parse(JSON.stringify(this.json.nodes[node_id]));
		},
		calculate_inputs() {
			this.inputs = [];
			for ( let edge_id = 0 ; edge_id<this.json.edges.length ; edge_id++ ) {
				let e = this.json.edges[edge_id];
				if ( e.target_node==this.node_id ) this.inputs[e.target_slot] = e.source_node;
			}
		}
	}
} ) ;
</script>
